var H=Object.defineProperty;var B=(e,t,i)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var r=(e,t,i)=>(B(e,typeof t!="symbol"?t+"":t,i),i);import{S as N,P as Q,C as W,W as _,a as Z,A as j,G as p,M as T,T as X,R as Y,b as x,c as I,d as m,e as y,f as O,g as V,V as K,D as k,h as F,B as G,Q as d,i as L,j as z,k as R,l as U,H as J,m as $,n as ee,o as te,p as ie,q as ae}from"./vendor.2a034b62.js";const ne=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function i(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=i(a);fetch(a.href,s)}};ne();class re{constructor(t){r(this,"el");r(this,"_boundHandleFrame");r(this,"startTime",-1);r(this,"glCanvas",document.createElement("canvas"));r(this,"glContext");r(this,"scene",new N);r(this,"camera",new Q(60,window.innerWidth/window.innerHeight,1,1e3));r(this,"renderer");this.el=t,this._boundHandleFrame=this._handleFrame.bind(this),t.appendChild(this.glCanvas),this.glCanvas.id="threecanvas",this.scene.background=new W(13421772),this.camera.position.set(0,15,-5),this.scene.add(this.camera);let i=this.glCanvas.getContext("webgl");if(!i)throw new Error("Cannot create WebGL render context in common.ts");this.glContext=i,this.renderer=new _({canvas:this.glCanvas,context:this.glContext,antialias:!0,alpha:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.glCanvas.offsetWidth,this.glCanvas.offsetHeight),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=Z,this.camera.aspect=this.glCanvas.offsetWidth/this.glCanvas.offsetHeight,this.camera.updateProjectionMatrix();const n=new j(2236962);this.scene.add(n),this.initializeScene(),window.addEventListener("resize",a=>{this.camera.aspect=this.el.offsetWidth/this.el.offsetHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.el.offsetWidth,this.el.offsetHeight)}),window.requestAnimationFrame(this._boundHandleFrame)}static offset(t){t=t||window.event;var i=t.target||t.srcElement,n=i.getBoundingClientRect(),a=t.clientX-n.left,s=t.clientY-n.top;return{x:a,y:s}}initializeScene(){}updateScene(t){}_handleFrame(t){window.requestAnimationFrame(this._boundHandleFrame),this.startTime==-1&&(this.startTime=t),this.updateScene(t),this.doRender()}doRender(){this.renderer.render(this.scene,this.camera)}}class D{constructor(){}getEnv(){const t=new p;t.name="environment";var i=this.createSky(),n=this.createGround();return t.add(i),t.add(n),t}getCharacter(){const t=new p;t.name="character",t.scale.set(.9,.9,.9);const i=new p;i.name="body",t.add(i);var n=this.createBodyMesh();i.add(n);const a=this.createOverheadMesh();a.name="screen",a.position.set(0,25,-4),i.add(a);const s=new p;s.name="head",i.add(s),s.position.set(0,11.8,0);const c=this.createHeadMesh();s.add(c);const S=this.createEyeMesh();S.position.set(-1.2,0,-3),s.add(S);const C=this.createEyeMesh();C.position.set(1.2,0,-3),s.add(C);const b=this.createMouthMesh();b.position.set(0,-2.2,-2),s.add(b);const M=new p;M.name="leftArm",i.add(M),M.rotateZ(T.degToRad(-75)),M.position.set(19,8.5,0);const o=this.createArmMesh(!0);M.add(o);const g=new p;g.name="rightArm",i.add(g),g.rotateZ(T.degToRad(125)),g.position.set(-10,0,0);const q=this.createArmMesh();g.add(q);const v=new p;v.name="leftLeg",i.add(v),v.position.set(3,-5,0);const l=this.createLegMesh();v.add(l);const h=this.createFootMesh();h.position.set(0,-15.5,0),v.add(h);const u=new p;u.name="rightLeg",i.add(u),u.position.set(-3,-5,0);const P=this.createLegMesh();u.add(P);const E=this.createFootMesh();return E.position.set(0,-15.5,0),u.add(E),t.castShadow=!0,t.receiveShadow=!1,t}createRepeatingTexture(t,i,n){var a=new X().load(t);return a.wrapS=a.wrapT=Y,a.repeat.set(i,n),a}createHeadMesh(){var t=4,i=new x(t),n=new I({color:65535,flatShading:!0}),a=new m(i,n);return a}createEyeMesh(){var t=1.2,i=new x(t,30),n=new y({color:16754433}),a=new m(i,n);return a}createArmMesh(t=!1){var i=new O(2,2,15);t&&i.translate(0,-15/2,0);var n=new I({color:65535,flatShading:!0}),a=new m(i,n);return a}createLegMesh(){var t=new O(2,2,15);t.translate(0,-15/2,0);var i=new I({color:65535,flatShading:!0}),n=new m(t,i);return n}createFootMesh(){var t=new V(2,2,30),i=new y({color:4163356}),n=new m(t,i);return n}createOverheadMesh(){var t=document.createElement("video");t.width=320,t.height=240,t.autoplay=!0,t.loop=!0,t.muted=!0,t.src="assets/sintel.mp4",document.body.addEventListener("mousedown",function(){t.muted=!1},!1),t.play();const i=new K(t);var n=new y({map:i,side:k}),a=new F(30,15,4,4),s=new m(a,n);return s}createBodyMesh(){var t=16,i=10,n=8,a=new G(i,t,n),s=new y({color:14527078}),c=new m(a,s);return c}createMouthMesh(){var t=.5,i=3,n=3,a=new G(i,t,n),s=new y({color:16777215}),c=new m(a,s);return c}createGround(){var t=2e3,i=new F(t,t),n=new I({color:15461616,depthWrite:!1}),a=new m(i,n);return a.receiveShadow=!0,a.rotation.x=-.5*Math.PI,a.position.set(0,0,0),a}createSky(){var t=800,i=new x(t,80,60,0,Math.PI*2,0,Math.PI),n=new y({map:this.createRepeatingTexture("assets/sky.png",2,2),side:k}),a=new m(i,n);return a.receiveShadow=!0,a}}const A={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.sin(Math.PI*(.5-e)))}},Exponential:{In:function(e){return e===0?0:Math.pow(1024,e-1)},Out:function(e){return e===1?1:1-Math.pow(2,-10*e)},InOut:function(e){return e===0?0:e===1?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return e===0?0:e===1?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return e===0?0:e===1?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return e===0?0:e===1?1:(e*=2,e<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1)}},Back:{In:function(e){const t=1.70158;return e===1?1:e*e*((t+1)*e-t)},Out:function(e){const t=1.70158;return e===0?0:--e*e*((t+1)*e+t)+1},InOut:function(e){const t=1.70158*1.525;return(e*=2)<1?.5*(e*e*((t+1)*e-t)):.5*((e-=2)*e*((t+1)*e+t)+2)}},Bounce:{In:function(e){return 1-A.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?A.Bounce.In(e*2)*.5:A.Bounce.Out(e*2-1)*.5+.5}},generatePow:function(e=4){return e=e<Number.EPSILON?Number.EPSILON:e,e=e>1e4?1e4:e,{In:function(t){return t**e},Out:function(t){return 1-(1-t)**e},InOut:function(t){return t<.5?(t*2)**e/2:(1-(2-t*2)**e)/2+.5}}}},w=-1.5,f=3,se=new ae;class he extends re{constructor(t){super(t);r(this,"miku");r(this,"helper");r(this,"animatedMesh");r(this,"animating",!1);r(this,"animSpeed",f);r(this,"animDist",100);r(this,"animTimeClip0",1500*Math.abs(2*w)/f);r(this,"animTimeClip1",1500*Math.abs(2*w)/f);r(this,"animTimeClip2",1500*Math.abs(2*w)/f);r(this,"animTimeClip3",1500*Math.abs(2*w)/f);r(this,"animTimeClip4",6e3*Math.abs(2*w)/f);r(this,"animTimeClip5",1500*Math.abs(2*w)/f);r(this,"animTimeClip6",1500*Math.abs(2*w)/f);r(this,"animStart",0);r(this,"animEnd",0);r(this,"animStartZ",-100);r(this,"animEndZ",-210);r(this,"animStartX",0);r(this,"animEndX",-45);r(this,"quatStart1End2",new d);r(this,"quatEnd1",new d);r(this,"quatStart2",new d);r(this,"quatStart",new d);r(this,"quatEnd",new d);r(this,"y",new L(0,1,0));r(this,"x",new L(1,0,0));r(this,"z",new L(0,0,1));r(this,"camZ",-5);r(this,"camY",15);r(this,"charstate",0);r(this,"resourceReady",!1);r(this,"inverseFactor",-1);r(this,"lastCallTime",0);r(this,"catModel");this.animatedMesh=this.scene.userData.animatedMesh,this.helper||(this.helper=new z({afterglow:2}))}setupLight(){const t=new R(16777215,.4);t.position.set(0,20,-20),t.angle=Math.PI/4,t.penumbra=.1,t.decay=1,t.distance=100,t.target.position.set(0,0,-100),this.scene.add(t.target),this.scene.add(t);const i=new U(16777215,.4);i.position.set(-2,1,1),this.scene.add(i),i.castShadow=!0,i.shadow.mapSize.width=2048,i.shadow.mapSize.height=2048;const n=50;i.shadow.camera.left=-n,i.shadow.camera.right=n,i.shadow.camera.top=n,i.shadow.camera.bottom=-n,i.shadow.camera.far=3500,i.shadow.bias=-1e-4;let a=new R(2241348,1);a.position.set(-60,40,-180),a.angle=Math.PI/4,a.penumbra=.1,a.decay=1,a.distance=200,a.castShadow=!0,a.shadow.mapSize.width=512,a.shadow.mapSize.height=512,a.shadow.camera.near=1,a.shadow.camera.far=200,a.shadow.focus=1,a.target.position.set(-70,0,-200),this.scene.add(a.target),this.scene.add(a);const s=new J(16777215,15461616,.3);s.position.set(0,200,0),this.scene.add(s)}initializeScene(){this.setupLight();const t=new p;t.name="root";const n=new D().getEnv(),a=new $(2e3,100,0,0);a.material.opacity=.2,a.material.transparent=!0,a.position.y=-5,this.scene.add(a),t.add(n);let s=new D().getCharacter();s.position.set(0,14,-100),this.scene.userData.animatedMesh=s,t.add(s),this.scene.add(t);const c=new ee;c.setDecoderPath("three/examples/js/libs/draco/gltf/");const S=new te;S.setDRACOLoader(c);var C=function(l){if(l.lengthComputable){var h=l.loaded/l.total*100;console.log(Math.round(h)+"% downloaded")}},b=function(l){console.log(l)};S.loadAsync("./assets/black__naughty/scene.gltf",C).then(function(l){const h=l.scene;h.name="cat",o.catModel=h,h.traverse(function(u){u.isMesh&&(u.castShadow=!0)}),h.scale.set(20,20,20),h.position.set(-20,0,-200),t.add(h),o.resourceReady=!0}),this.helper=new z({afterglow:2});const o=this,g="assets/miku/miku_v2.pmd",q=["assets/miku/wavefile_v2.vmd"];new ie().loadWithAnimation(g,q,function(l){o.miku=l.mesh;var h=o.miku.material;if(Array.isArray(h))for(var u=0,P=h.length;u<P;u++){var E=h[u];E.emissiveIntensity=.2}o.miku.castShadow=!0,o.miku.receiveShadow=!0,o.helper.add(o.miku,{animation:l.animation,physics:!0}),o.miku.position.set(-70,0,-200),o.miku.scale.set(1.5,1.5,1.5),t.add(o.miku)},C,b)}updateScene(t){if(!!this.resourceReady){this.animating||(this.animating=!0,this.animStart=t,this.animEnd=this.animStart+this.animTimeClip0),t>this.animEnd&&(this.animStart=this.animEnd,this.charstate++,this.charstate>6&&(this.charstate=0,this.reset()));var i=0;switch(this.charstate){case 0:this.animEnd=this.animStart+this.animTimeClip0,i=(t-this.animStart)/this.animTimeClip0,this.playanimationClip0(i);break;case 1:this.animEnd=this.animStart+this.animTimeClip1,i=(t-this.animStart)/this.animTimeClip1,this.playanimationClip1(i);break;case 2:this.animEnd=this.animStart+this.animTimeClip2,i=(t-this.animStart)/this.animTimeClip2,this.playanimationClip2(i);break;case 3:this.animEnd=this.animStart+this.animTimeClip3,i=(t-this.animStart)/this.animTimeClip3,this.playanimationClip3(i);break;case 4:this.animEnd=this.animStart+this.animTimeClip4,i=(t-this.animStart)/this.animTimeClip4;let n=(t-this.animStart)%400/400;this.playanimationClip4(i),this.playanimationClip4Cam(i),this.playanimationClip4Leg(n),this.lastCallTime=t;break;case 5:this.animEnd=this.animStart+this.animTimeClip5,i=(t-this.animStart)/this.animTimeClip5,this.playanimationClip0(i);break;case 6:this.animEnd=this.animStart+this.animTimeClip5,i=(t-this.animStart)/this.animTimeClip5,this.playanimationClip1(i);break}this.helper.update(se.getDelta())}}playanimationClip0(t){this.quatStart1End2.setFromAxisAngle(this.y,0),this.quatEnd1.setFromAxisAngle(this.y,Math.PI-.01),this.quatStart.copy(this.quatStart1End2),this.quatEnd.copy(this.quatEnd1),this.animatedMesh.quaternion.slerpQuaternions(this.quatStart,this.quatEnd,t)}reset(){this.camera.position.set(0,this.camY,-5),this.animatedMesh.position.set(0,14,-100);let t=new L;this.animatedMesh.getWorldPosition(t),this.camera.lookAt(t),this.catModel.scale.set(20,20,20)}playanimationClip1(t){let i=this.getLeftArm(),n=new d;n.setFromAxisAngle(this.z,.8*Math.PI);let a=new d;a.setFromAxisAngle(this.z,-Math.PI*(3.5/2)),i==null||i.quaternion.slerpQuaternions(n,a,t)}getLeftArm(){let t=this.animatedMesh.getObjectByName("leftArm");return t==null||t.position.set(4,5.2,0),t}playanimationClip2(t){let i=this.getLeftArm(),n=new d;n.setFromAxisAngle(this.z,-Math.PI*(3.5/2));let a=new d;a.setFromAxisAngle(this.z,.6*Math.PI),i==null||i.quaternion.slerpQuaternions(n,a,t)}playanimationClip3(t){this.quatStart1End2.setFromAxisAngle(this.y,Math.PI-.01),this.quatEnd1.setFromAxisAngle(this.y,0),this.quatStart.copy(this.quatStart1End2),this.quatEnd.copy(this.quatEnd1),this.animatedMesh.quaternion.slerpQuaternions(this.quatStart,this.quatEnd,t)}playanimationClip4(t){this.catModel.scale.x=(1-t)*20+t*30,this.catModel.scale.y=(1-t)*20+t*30,this.catModel.scale.z=(1-t)*20+t*30,this.animatedMesh.position.z=(1-t)*this.animStartZ+t*this.animEndZ,this.animatedMesh.position.x=(1-t)*this.animStartX+t*this.animEndX}playanimationClip4Leg(t){t=A.Quadratic.InOut(t);let i=this.getLeftLeg(),n=this.getRightLeg(),a=new d;a.setFromAxisAngle(this.x,-Math.PI/8);let s=new d;s.setFromAxisAngle(this.x,Math.PI/8),i==null||i.quaternion.slerpQuaternions(a,s,t),n==null||n.quaternion.slerpQuaternions(s,a,t)}playanimationClip4Cam(t){let i=new d,n=new d;i.setFromAxisAngle(this.y,0),n.setFromAxisAngle(this.y,-Math.PI/2),this.camera.quaternion.slerpQuaternions(i,n,t),this.camera.position.z=(1-t)*this.camZ+t*this.animStartZ/2,this.camera.position.y=(1-t)*this.camY+t*50;let a=new L;this.animatedMesh.getWorldPosition(a),this.camera.lookAt(a)}getLeftLeg(){return this.animatedMesh.getObjectByName("leftLeg")}getRightLeg(){return this.animatedMesh.getObjectByName("rightLeg")}}function oe(){var e=document.getElementById("drawing");if(!e){console.warn("Your HTML page needs a DIV with id='drawing'");return}new he(e)}oe();
